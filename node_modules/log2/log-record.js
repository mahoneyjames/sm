const util = require("util");
class LogRecord
{
    constructor(category, label,level="info", outputFunction)
    {
        this.data  = {
            category, label, level
        };        

        this.isSaved = false;           
        this.outputFunction = outputFunction;   
    }

    message(msg, ...params)
    {        
        this.data.message = util.format(msg,...params);        
        return this;
    }

    setContextData(name,value)
    {
        this.data[name] = value;
    }

    setDetailsData(name, value)
    {
        if(!this.data.details)
        {
            this.data.details = {};
        }

        this.data.details[name] = value;
    }
    appendMessage(msg, ...params)
    {
        if(!this.data.messages)
        {
            this.data.messages = [];            
        }
                
        this.data.messages.push(util.format(msg,...params));        
    }
    
    appendThing(what)
    {
        if(!this.data.things)
        {
            this.data.things = [];
        }
        this.data.things.push(what);
    }

    writeLogRecord()
    {
        if(!this.isSaved)
        {
            this.outputFunction(this.data);   
            this.isSaved = true;            
        }
        return this;
    }

}

module.exports = LogRecord;